<!--index.wxml-->
<wxs src="../../utils/util.wxs" module="util" />

<view class="container">
  <view wx:if="{{!points.length&&isLogin}}" class="no-content">
    <view style="margin-bottom: 40rpx;">
      <text>还没有任何足迹，快来添加你的第一条纪录</text>
    </view>
    <button type="primary" bindtap="openCreate">创建足迹</button>
  </view>
  
  <view class="poi-container" wx:if="{{points.length}}">
    <block wx:for="{{points}}" >
    <view class="poi-heading flex">
      <text class="h1">{{util.formatTime(item.dateTime,"yyyy-MM-dd")}}</text>
      <text class="h1">{{item.city}}</text>
    </view>
    <view class="card" data-poi="{{item}}">

      <view>
        <swiper wx:if="{{item.images.length}}" indicator-dots="{{item.images.length>1}}" indicator-color="rgba(100,100,100,0.3)"	indicator-active-color="#45a1e2">
          <block wx:for="{{item.images}}" wx:for-item="img" wx:for-key="imgIndex">
            <swiper-item>
              <image bindtap="openPreview" data-current="{{img.url}}" data-src="{{item.images}}" src="{{img.url}}" mode="aspectFill"></image>
            </swiper-item>
          </block>
        </swiper>
      </view>
      <view class="poi-content" bindtap="openDetail" bindlongpress="openEditAction" data-poi="{{item}}">
        <view><text class="h3">{{item.title}}</text></view>
        <view class="flex">
          <text class="h4">{{item.address}}</text>
          <text class="h4">{{util.formatTime(item.dateTime,"yyyy-MM-dd")}}</text>
        </view>
        <view></view>
        <view><text class="p">{{util.shortRemark(item.remark)}}</text></view>
      </view>

    </view>
    </block>
  </view>
  <view class="poi-edit-container"  wx:if="{{isEditShow}}"> 
    <view class="poi-edit" style="bottom:{{keyboardHeight}}px">
      <form catchsubmit="formSubmit" catchreset="formReset">
        <view class="page-section">
          <textarea name="remark" cursor-spacing="100" fixed	 value="{{current_poi.remark}}" maxlength="-1" bindblur="poiEditBlur" bindfocus="poiEditFocus" adjust-position="{{false}}" show-confirm-bar="{{false}}"></textarea>
        </view>      

        <view class="flex">
          <button type="default" bindtap="closeEdit">取消</button>
          <button type="primary" formType="submit">确认更新</button>
        </view>
      </form>
    </view>
  </view>
  <view wx:if="{{!isLogin}}" class="login-container">
    <button type="primary" bindtap="openLogin">登录</button>
  </view>
</view>
